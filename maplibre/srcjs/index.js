(()=>{function c(i,e){return e===null?Object.keys(i.properties).map(o=>`${o}: ${i.properties[o]}`).join("</br>"):i.properties[e]}var p=class{constructor(e){this._id=e.container,this._map=new maplibregl.Map(e),this._map.on("mouseover",()=>{this._map.getCanvas().style.cursor="pointer"}),this._map.on("mouseout",()=>{this._map.getCanvas().style.cursor=""}),this._map.addControl(new maplibregl.NavigationControl)}getMap(){return this._map}applyMapMethod(e,t){this._map[e](...t)}addControl(e,t,o){this._map.addControl(new maplibregl[e](t),o)}addMarker({lngLat:e,popup:t,options:o}){let n=new maplibregl.Marker(o).setLngLat(e);if(t){let a=new maplibregl.Popup(t.options).setHTML(t.text);n.setPopup(a)}n.addTo(this._map)}addLayer(e){this._map.addLayer(e),typeof Shiny<"u"&&this._map.on("click",e.id,t=>{console.log(t,t.features[0]);let o=e.id.replaceAll("-","_"),n=`${this._id}_layer_${o}`,a={props:t.features[0].properties,layer_id:e.id};console.log(n,a),Shiny.onInputChange(n,a)})}addPopup(e,t){let o={closeButton:!1},n=new maplibregl.Popup(o);this._map.on("click",e,a=>{let s=a.features[0].properties[t];n.setLngLat(a.lngLat).setHTML(s).addTo(this._map)})}addTooltip(e,t){let o={closeButton:!1,closeOnClick:!1},n=new maplibregl.Popup(o);this._map.on("mousemove",e,a=>{let r=a.features[0],s=c(r,t);n.setLngLat(a.lngLat).setHTML(s).addTo(this._map)}),this._map.on("mouseleave",e,()=>{n.remove()})}setSourceData(e,t){this._map.getSource(e).setData(t)}render(e){e.forEach(([t,o])=>{if(["addLayer","addPopup","addTooltip","addMarker","addPopup","addControl","setSourceData"].includes(t)){console.log("Custom method",t,o),this[t](...o);return}console.log("Map method",t),this.applyMapMethod(t,o)})}};var u="0.1.0";console.log("pymaplibregl",u);typeof Shiny>"u"&&(window.pymaplibregl=function({mapOptions:i,calls:e}){let t="pymaplibregl",o=document.getElementById(t),n=new p(Object.assign({container:o.id},i));n.getMap().on("load",()=>{n.render(e)})});if(typeof Shiny<"u"){class i extends Shiny.OutputBinding{find(t){return t.find(".shiny-maplibregl-output")}renderValue(t,o){console.log("id:",t.id,"payload:",o);let n=new p(Object.assign({container:t.id},o.mapData.mapOptions)),a=n.getMap();a.on("load",()=>{n.render(o.mapData.calls)}),a.on("click",s=>{console.log(s);let l=`${t.id}`,d={coords:s.lngLat,point:s.point};console.log(l,d),Shiny.onInputChange(l,d)});let r=`pymaplibregl-${t.id}`;console.log(r),Shiny.addCustomMessageHandler(r,({id:s,calls:l})=>{console.log(s,l),n.render(l)})}}Shiny.outputBindings.register(new i,"shiny-maplibregl-output")}})();
